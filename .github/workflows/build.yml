#!/bin/bash
echo "============================================"
echo "  Pack Mac Executable - Business Monitor Report"
echo "============================================"
echo

cd "$(dirname "$0")"

# 检查 Python 3
if ! command -v python3 &> /dev/null; then
    echo "[ERROR] Python3 not found. Please install Python 3.8+"
    echo "Download: https://www.python.org/downloads/"
    read -p "Press Enter to exit..."
    exit 1
fi

echo "[1/3] Installing dependencies..."
pip3 install pyinstaller pymysql pandas xlsxwriter openpyxl -q
if [ $? -ne 0 ]; then
    echo "[ERROR] Failed to install dependencies."
    read -p "Press Enter to exit..."
    exit 1
fi

echo
echo "[2/3] Packaging executable (first time may take 1-2 minutes)..."
pyinstaller --onefile --console --name "salesman_monitor_mac" \
    --hidden-import pymysql --hidden-import pymysql.cursors \
    --hidden-import pandas --hidden-import xlsxwriter --hidden-import openpyxl \
    business_monitor.py

if [ $? -ne 0 ]; then
    echo "[ERROR] Packaging failed."
    read -p "Press Enter to exit..."
    exit 1
fi

echo
echo "[3/3] Cleaning up temp files..."
rm -rf build
rm -f salesman_monitor_mac.spec

echo
echo "============================================"
echo "  Done! Executable is at: $(pwd)/dist/salesman_monitor_mac"
echo "  Double-click to run (Terminal will open), report saves to same folder"
echo "============================================"
echo
read -p "Press Enter to exit..."
